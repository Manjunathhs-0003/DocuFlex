{% extends "base.html" %}

{% block title %}Add New Document - Fleet Management{% endblock %}

{% block content %}
<div class="container">
    <h1 class="mt-4">Add New Document</h1>
    <form method="POST" action="">
        {{ form.hidden_tag() }}
        <div class="form-group">
            {{ form.document_type.label(class="form-label") }}<br>
            {{ form.document_type(class="form-control", id="document_type") }}
        </div>
        <div id="common-fields">
            <div class="form-group">
                {{ form.serial_number.label(class="form-label") }}<br>
                {{ form.serial_number(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.start_date.label(class="form-label") }}<br>
                {{ form.start_date(class="form-control", type="date") }}
            </div>
            <div class="form-group">
                {{ form.end_date.label(class="form-label") }}<br>
                {{ form.end_date(class="form-control", type="date") }}
            </div>
        </div>
        <div id="insurance-fields" style="display:none;">
            <div class="form-group">
                {{ form.insurance_policy_number.label(class="form-label") }}<br>
                {{ form.insurance_policy_number(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.insurance_company_name.label(class="form-label") }}<br>
                {{ form.insurance_company_name(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.policy_start_date.label(class="form-label") }}<br>
                {{ form.policy_start_date(class="form-control", type="date") }}
            </div>
            <div class="form-group">
                {{ form.policy_expiry_date.label(class="form-label") }}<br>
                {{ form.policy_expiry_date(class="form-control", type="date") }}
            </div>
            <div class="form-group">
                {{ form.policy_coverage_amount.label(class="form-label") }}<br>
                {{ form.policy_coverage_amount(class="form-control") }}
            </div>
        </div>
        <div id="emission-fields" style="display:none;">
            <div class="form-group">
                {{ form.emission_certificate_number.label(class="form-label") }}<br>
                {{ form.emission_certificate_number(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.emission_start_date.label(class="form-label") }}<br>
                {{ form.emission_start_date(class="form-control", type="date") }}
            </div>
            <div class="form-group">
                {{ form.emission_end_date.label(class="form-label") }}<br>
                {{ form.emission_end_date(class="form-control", type="date") }}
            </div>
        </div>
        <div id="permit-fields" style="display:none;">
            <div class="form-group">
                {{ form.permit_number.label(class="form-label") }}<br>
                {{ form.permit_number(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.issuing_authority.label(class="form-label") }}<br>
                {{ form.issuing_authority(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.permit_start_date.label(class="form-label") }}<br>
                {{ form.permit_start_date(class="form-control", type="date") }}
            </div>
            <div class="form-group">
                {{ form.permit_end_date.label(class="form-label") }}<br>
                {{ form.permit_end_date(class="form-control", type="date") }}
            </div>
        </div>
        <div id="fitness-fields" style="display:none;">
            <div class="form-group">
                {{ form.fitness_certificate_number.label(class="form-label") }}<br>
                {{ form.fitness_certificate_number(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.fitness_issuing_authority.label(class="form-label") }}<br>
                {{ form.fitness_issuing_authority(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.fitness_start_date.label(class="form-label") }}<br>
                {{ form.fitness_start_date(class="form-control", type="date") }}
            </div>
            <div class="form-group">
                {{ form.fitness_end_date.label(class="form-label") }}<br>
                {{ form.fitness_end_date(class="form-control", type="date") }}
            </div>
        </div>
        <div id="road-tax-fields" style="display:none;">
            <div class="form-group">
                {{ form.road_tax_receipt_number.label(class="form-label") }}<br>
                {{ form.road_tax_receipt_number(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.road_tax_amount.label(class="form-label") }}<br>
                {{ form.road_tax_amount(class="form-control") }}
            </div>
            <div class="form-group">
                {{ form.road_tax_payment_date.label(class="form-label") }}<br>
                {{ form.road_tax_payment_date(class="form-control", type="date") }}
            </div>
        </div>
        <div class="form-group">
            {{ form.submit(class="btn btn-primary") }}
        </div>
    </form>
</div>

<!-- JavaScript to toggle fields based on document type -->
<script>
    document.getElementById('document_type').onchange = function() {
        var docType = this.value;
        var commonFields = document.getElementById('common-fields');
        var insuranceFields = document.getElementById('insurance-fields');
        var emissionFields = document.getElementById('emission-fields');
        var permitFields = document.getElementById('permit-fields');
        var fitnessFields = document.getElementById('fitness-fields');
        var roadTaxFields = document.getElementById('road-tax-fields');

        commonFields.style.display = 'none';
        insuranceFields.style.display = 'none';
        emissionFields.style.display = 'none';
        permitFields.style.display = 'none';
        fitnessFields.style.display = 'none';
        roadTaxFields.style.display = 'none';

        if (docType === 'Insurance') {
            insuranceFields.style.display = 'block';
        } else if(docType === 'Emission Certificate') {
            emissionFields.style.display = 'block';
        } else if(docType === 'Permit') {
            permitFields.style.display = 'block';
        } else if(docType === 'Fitness Certificate') {
            fitnessFields.style.display = 'block';
        } else if(docType === 'Road Tax') {
            roadTaxFields.style.display = 'block';
        } else {
            commonFields.style.display = 'block';
        }
    };

    // Trigger change event to set the correct initial state
    document.getElementById('document_type').onchange();
</script>
{% endblock %}